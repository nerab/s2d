#!/usr/bin/env ruby

require 'bundler'
Bundler.require

device = File.basename($0)
target = S2D::Device.lookup(device)

if target.nil?
  STDERR.puts "Device #{device} not configured"
  exit 1
end

message = S2D::Message.new

if ARGV.size > 0
  message.body = ARGV.join(' ')
else
  puts 'Type your message and end with Control-D.'
  message.body = ARGF.read
end

if message.invalid?
  STDERR.puts "Invalid message"
  exit 1
else
  target.deliver(message)
end
